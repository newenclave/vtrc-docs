#Не закончено!

Проектик **stress**, может показать, как работает библиотека в тех или иных условиях. Адрес примера: https://github.com/newenclave/vtrc/tree/master/examples/stress

Как и во всех остальных примерах, код разделен на 3 части: 

 * client — клиентская часть 
 * protocol — описание протокола (общая часть, используемая и клиентом, и сервером)
 * server — серверная часть 

Доступные опции сервероной части: **./stress_server --help**

    -? [ --help ]              help message
    -s [ --server ] arg        endpoint name; <tcp address>:<port> or <pipe/file 
                               name>
    -i [ --io-pool-size ] arg  threads for io operations; default = 1
    -r [ --rpc-pool-size ] arg threads for rpc calls; default = 1
    -t [ --tcp-nodelay ]       set TCP_NODELAY flag for tcp sockets
    -o [ --only-pool ]         use io pool for io operations and rpc calls
    -M [ --message-size ] arg  maximum message size for protocol
    -S [ --stack-size ] arg    maximum recursion depth for both side

тут: 

* help — вывод помощи

* **server** — список открываемых серверных точек, имена точек задаются в формате ipaddress:port, либо local_path_name, где  local_path_name может быть именем *Named pipe* в случае системы Windows или именем *Unix domain socket* в случае POSIX систем. Точек может быть несколько.

* **io-pool-size** — количество потоков, используемых для обработки системных событийс (чтение сокета или пайпа, прием новых клиентов). Может принимать значение от 1 и больше.

* **rpc-pool-size** — количество потоков, назначенных на выполнение процедур. Все удаленные вызовы будут выполнятся в этих потоках. Может принимать значение от 1 и больше.

* **only-pool** — параметр, который говорит серверу обрабатывать и системные события, и удаленные вызовы на одном и том же диспетчере, параметр **io-pool-size**, в этом случае задает количество потоков для этого диспетчера, параметр **rpc-pool-size** игнорируется. Запуск сервера с одним только ключом **--only-pool** запустит сервер только с 1 потоком (это будет главный поток функции main) и все все будет обрабатываться в нём.

* **message-size** — задает максимальный размер сообщения с запросом, либо ответом. Превышение этого размера является грубым нарушение протокола и соединение незамедлительно закрывается. По-умолчанию это значение равно 65536 байт. Максимальное значение — 64 мегабайта.

* **stack-size** — задает максимально допустимую глубину вызовов (см description.md)

* **tcp-nodelay** — устанавливает флаг TCP_NODELAY для tcp соединений. Этот флаг отключает действие *алгоритма Нейгла* (http://tools.ietf.org/html/rfc896). Действие этого алгоритма очень хорошо просматривается при выполнении stress теста с событиями (см ниже запрос событий у сервера клиентом), используя tcp соединения.
Пример: 
Запуск сервера : 

    ./stress_server --server=0.0.0.0:55555 --server=:::55556 --server=/home/sandbox/stress.sock -o

    Starting listener at '0.0.0.0:55555'...Ok
    Starting listener at ':::55556'...Ok
    Starting listener at '/home/sandbox/stress.sock'...Ok

Запустит сервер с 3 точками и будет использовать поток функции main для всей работы. В такой схеме без проблем работают вызовы, которые не требуют долгой обработки на стороне сервера. Всё выполняется последовательно. 

При 

    ./stress_server --server=0.0.0.0:55555 --server=:::55556 --server=/home/sandbox/stress.sock -i2 -r4

Запустится сервер с теми же 3 точками, но для обработки системных событий будет использовано 2 потока, а для исполнения вызовов — 3.

